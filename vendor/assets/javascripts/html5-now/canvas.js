/*
  base2 - copyright 2007-2009, Dean Edwards
  http://code.google.com/p/base2/
  http://www.opensource.org/licenses/mit-license.php

  Contributors:
    Doeke Zanstra
*/
document.createElement("canvas").getContext||(function(){var s=Math,j=s.round,F=s.sin,G=s.cos,X=s.abs,Y=s.sqrt,m=10,w=m/2;function Z(){return this.context_||(this.context_=new H(this))}var N=Array.prototype.slice;function ba(a,b){var c=N.call(arguments,2);return function(){return a.apply(b,c.concat(N.call(arguments)))}}var O={init:function(a){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var b=a||document;b.createElement("canvas");b.attachEvent("onreadystatechange",ba(this.init_,this,b))}},init_:function(a){a.namespaces.g_vml_||a.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");a.namespaces.g_o_||a.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!a.styleSheets.ex_canvas_){var b=a.createStyleSheet();b.owningElement.id="ex_canvas_";b.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}var c=a.getElementsByTagName("canvas"),d=0;for(;d<c.length;d++)this.initElement(c[d])},initElement:function(a){if(!a.getContext){a.getContext=Z;a.innerHTML="";a.attachEvent("onpropertychange",bb);a.attachEvent("onresize",bc);var b=a.attributes;if(b.width&&b.width.specified)a.style.width=b.width.nodeValue+"px";else a.width=a.clientWidth;if(b.height&&b.height.specified)a.style.height=b.height.nodeValue+"px";else a.height=a.clientHeight}return a}};function bb(a){var b=a.srcElement;switch(a.propertyName){case"width":b.style.width=b.attributes.width.nodeValue+"px";b.getContext().clearRect();break;case"height":b.style.height=b.attributes.height.nodeValue+"px";b.getContext().clearRect();break}}function bc(a){var b=a.srcElement;if(b.firstChild){b.firstChild.style.width=b.clientWidth+"px";b.firstChild.style.height=b.clientHeight+"px"}}O.init();var P=[],B=0;for(;B<16;B++){var C=0;for(;C<16;C++)P[B*16+C]=B.toString(16)+C.toString(16)}function I(){return[[1,0,0],[0,1,0],[0,0,1]]}function x(a,b){var c=I(),d=0;for(;d<3;d++){var e=0;for(;e<3;e++){var h=0,g=0;for(;g<3;g++)h+=a[d][g]*b[g][e];c[d][e]=h}}return c}function Q(a,b){b.fillStyle=a.fillStyle;b.lineCap=a.lineCap;b.lineJoin=a.lineJoin;b.lineWidth=a.lineWidth;b.miterLimit=a.miterLimit;b.shadowBlur=a.shadowBlur;b.shadowColor=a.shadowColor;b.shadowOffsetX=a.shadowOffsetX;b.shadowOffsetY=a.shadowOffsetY;b.strokeStyle=a.strokeStyle;b.globalAlpha=a.globalAlpha;b.arcScaleX_=a.arcScaleX_;b.arcScaleY_=a.arcScaleY_;b.lineScale_=a.lineScale_}function R(a){var b,c=1;a=String(a);if(a.substring(0,3)=="rgb"){var d=a.indexOf("(",3),e=a.indexOf(")",d+1),h=a.substring(d+1,e).split(",");b="#";var g=0;for(;g<3;g++)b+=P[Number(h[g])];if(h.length==4&&a.substr(3,1)=="a")c=h[3]}else b=a;return{color:b,alpha:c}}function bd(a){switch(a){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function H(a){this.m_=I();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=m*1;this.globalAlpha=1;this.canvas=a;var b=a.ownerDocument.createElement("div");b.style.width=a.clientWidth+"px";b.style.height=a.clientHeight+"px";b.style.overflow="hidden";b.style.position="absolute";a.appendChild(b);this.element_=b;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1}var i=H.prototype;i.clearRect=function(){this.element_.innerHTML=""};i.beginPath=function(){this.currentPath_=[]};i.moveTo=function(a,b){var c=this.getCoords_(a,b);this.currentPath_.push({type:"moveTo",x:c.x,y:c.y});this.currentX_=c.x;this.currentY_=c.y};i.lineTo=function(a,b){var c=this.getCoords_(a,b);this.currentPath_.push({type:"lineTo",x:c.x,y:c.y});this.currentX_=c.x;this.currentY_=c.y};i.bezierCurveTo=function(a,b,c,d,e,h){var g=this.getCoords_(e,h),k=this.getCoords_(a,b),n=this.getCoords_(c,d);S(this,k,n,g)};function S(a,b,c,d){a.currentPath_.push({type:"bezierCurveTo",cp1x:b.x,cp1y:b.y,cp2x:c.x,cp2y:c.y,x:d.x,y:d.y});a.currentX_=d.x;a.currentY_=d.y}i.quadraticCurveTo=function(a,b,c,d){var e=this.getCoords_(a,b),h=this.getCoords_(c,d),g={x:this.currentX_+0.6666666666666666*(e.x-this.currentX_),y:this.currentY_+0.6666666666666666*(e.y-this.currentY_)};S(this,g,{x:g.x+(h.x-this.currentX_)/3,y:g.y+(h.y-this.currentY_)/3},h)};i.arc=function(a,b,c,d,e,h){c*=m;var g=h?"at":"wa",k=a+G(d)*c-w,n=b+F(d)*c-w,p=a+G(e)*c-w,f=b+F(e)*c-w;if(k==p&&!h)k+=0.125;var l=this.getCoords_(a,b),o=this.getCoords_(k,n),q=this.getCoords_(p,f);this.currentPath_.push({type:g,x:l.x,y:l.y,radius:c,xStart:o.x,yStart:o.y,xEnd:q.x,yEnd:q.y})};i.rect=function(a,b,c,d){this.moveTo(a,b);this.lineTo(a+c,b);this.lineTo(a+c,b+d);this.lineTo(a,b+d);this.closePath()};i.strokeRect=function(a,b,c,d){var e=this.currentPath_;this.beginPath();this.moveTo(a,b);this.lineTo(a+c,b);this.lineTo(a+c,b+d);this.lineTo(a,b+d);this.closePath();this.stroke();this.currentPath_=e};i.fillRect=function(a,b,c,d){var e=this.currentPath_;this.beginPath();this.moveTo(a,b);this.lineTo(a+c,b);this.lineTo(a+c,b+d);this.lineTo(a,b+d);this.closePath();this.fill();this.currentPath_=e};i.createLinearGradient=function(a,b,c,d){var e=new D("gradient");e.x0_=a;e.y0_=b;e.x1_=c;e.y1_=d;return e};i.createRadialGradient=function(a,b,c,d,e,h){var g=new D("gradientradial");g.x0_=a;g.y0_=b;g.r0_=c;g.x1_=d;g.y1_=e;g.r1_=h;return g};i.drawImage=function(a){var b,c,d,e,h,g,k,n,p=a.runtimeStyle.width,f=a.runtimeStyle.height;a.runtimeStyle.width="auto";a.runtimeStyle.height="auto";var l=a.width,o=a.height;a.runtimeStyle.width=p;a.runtimeStyle.height=f;if(arguments.length==3){b=arguments[1];c=arguments[2];h=g=0;k=d=l;n=e=o}else if(arguments.length==5){b=arguments[1];c=arguments[2];d=arguments[3];e=arguments[4];h=g=0;k=l;n=o}else if(arguments.length==9){h=arguments[1];g=arguments[2];k=arguments[3];n=arguments[4];b=arguments[5];c=arguments[6];d=arguments[7];e=arguments[8]}else throw Error("Invalid number of arguments");var q=this.getCoords_(b,c),r=[];r.push(" <g_vml_:group",' coordsize="',m*10,",",m*10,'"',' coordorigin="0,0"',' style="width:',10,"px;height:",10,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var y=[];y.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",j(q.x/m),",","Dy=",j(q.y/m),"");var t=q,E=this.getCoords_(b+d,c),u=this.getCoords_(b,c+e),z=this.getCoords_(b+d,c+e);t.x=s.max(t.x,E.x,u.x,z.x);t.y=s.max(t.y,E.y,u.y,z.y);r.push("padding:0 ",j(t.x/m),"px ",j(t.y/m),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",y.join(""),", sizingmethod='clip');")}else r.push("top:",j(q.y/m),"px;left:",j(q.x/m),"px;");r.push(' ">','<g_vml_:image src="',a.src,'"',' style="width:',m*d,"px;"," height:",m*e,'px;"',' cropleft="',h/l,'"',' croptop="',g/o,'"',' cropright="',(l-h-k)/l,'"',' cropbottom="',(o-g-n)/o,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",r.join(""))};i.stroke=function(c){var d=[],e=R(c?this.fillStyle:this.strokeStyle),h=e.color,g=e.alpha*this.globalAlpha;d.push("<g_vml_:shape",' filled="',!!c,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0 0" coordsize="',m*10," ",m*10,'"',' stroked="',!c,'"',' path="');var k={x:null,y:null},n={x:null,y:null},p=0;for(;p<this.currentPath_.length;p++){var f=this.currentPath_[p];switch(f.type){case"moveTo":d.push(" m ",j(f.x),",",j(f.y));break;case"lineTo":d.push(" l ",j(f.x),",",j(f.y));break;case"close":d.push(" x ");f=null;break;case"bezierCurveTo":d.push(" c ",j(f.cp1x),",",j(f.cp1y),",",j(f.cp2x),",",j(f.cp2y),",",j(f.x),",",j(f.y));break;case"at":case"wa":d.push(" ",f.type," ",j(f.x-this.arcScaleX_*f.radius),",",j(f.y-this.arcScaleY_*f.radius)," ",j(f.x+this.arcScaleX_*f.radius),",",j(f.y+this.arcScaleY_*f.radius)," ",j(f.xStart),",",j(f.yStart)," ",j(f.xEnd),",",j(f.yEnd));break}if(f){if(k.x==null||f.x<k.x)k.x=f.x;if(n.x==null||f.x>n.x)n.x=f.x;if(k.y==null||f.y<k.y)k.y=f.y;if(n.y==null||f.y>n.y)n.y=f.y}}d.push(' ">');if(c)if(typeof this.fillStyle=="object"){var l=this.fillStyle,o=0,q={x:0,y:0},r=0,y=1;if(l.type_=="gradient"){var t=l.x1_/this.arcScaleX_,E=l.y1_/this.arcScaleY_,u=this.getCoords_(l.x0_/this.arcScaleX_,l.y0_/this.arcScaleY_),z=this.getCoords_(t,E);o=Math.atan2(z.x-u.x,z.y-u.y)*180/Math.PI;if(o<0)o+=360;if(o<1.0E-6)o=0}else{var u=this.getCoords_(l.x0_,l.y0_),J=n.x-k.x,K=n.y-k.y;q={x:(u.x-k.x)/J,y:(u.y-k.y)/K};J/=this.arcScaleX_*m;K/=this.arcScaleY_*m;var T=s.max(J,K);r=2*l.r0_/T;y=2*l.r1_/T-r}var v=l.colors_;v.sort(function(a,b){return a.offset-b.offset});var L=v.length,be=v[0].color,bf=v[L-1].color,bg=v[0].alpha*this.globalAlpha,bh=v[L-1].alpha*this.globalAlpha,U=[],p=0;for(;p<L;p++){var V=v[p];U.push(V.offset*y+r+" "+V.color)}d.push('<g_vml_:fill type="',l.type_,'"',' method="none" focus="100%"',' color="',be,'"',' color2="',bf,'"',' colors="',U.join(","),'"',' opacity="',bh,'"',' g_o_:opacity2="',bg,'"',' angle="',o,'"',' focusposition="',q.x,",",q.y,'" />')}else d.push('<g_vml_:fill color="',h,'" opacity="',g,'" />');else{var M=this.lineScale_*this.lineWidth;if(M<1)g*=M;d.push("<g_vml_:stroke",' opacity="',g,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',bd(this.lineCap),'"',' weight="',M,'px"',' color="',h,'" />')}d.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",d.join(""))};i.fill=function(){this.stroke(true)};i.closePath=function(){this.currentPath_.push({type:"close"})};i.getCoords_=function(a,b){var c=this.m_;return{x:m*(a*c[0][0]+b*c[1][0]+c[2][0])-w,y:m*(a*c[0][1]+b*c[1][1]+c[2][1])-w}};i.save=function(){var a={};Q(this,a);this.aStack_.push(a);this.mStack_.push(this.m_);this.m_=x(I(),this.m_)};i.restore=function(){Q(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};function bi(a){var b=0;for(;b<3;b++){var c=0;for(;c<2;c++)if(!isFinite(a[b][c])||isNaN(a[b][c]))return false}return true}function A(a,b,c){if(!!bi(b)){a.m_=b;if(c)a.lineScale_=Y(X(b[0][0]*b[1][1]-b[0][1]*b[1][0]))}}i.translate=function(a,b){A(this,x([[1,0,0],[0,1,0],[a,b,1]],this.m_),false)};i.rotate=function(a){var b=G(a),c=F(a);A(this,x([[b,c,0],[-c,b,0],[0,0,1]],this.m_),false)};i.scale=function(a,b){this.arcScaleX_*=a;this.arcScaleY_*=b;A(this,x([[a,0,0],[0,b,0],[0,0,1]],this.m_),true)};i.transform=function(a,b,c,d,e,h){A(this,x([[a,b,0],[c,d,0],[e,h,1]],this.m_),true)};i.setTransform=function(a,b,c,d,e,h){A(this,[[a,b,0],[c,d,0],[e,h,1]],true)};i.clip=function(){};i.arcTo=function(){};i.createPattern=function(){return new W};function D(a){this.type_=a;this.r1_=this.y1_=this.x1_=this.r0_=this.y0_=this.x0_=0;this.colors_=[]}D.prototype.addColorStop=function(a,b){b=R(b);this.colors_.push({offset:a,color:b.color,alpha:b.alpha})};function W(){}G_vmlCanvasManager=O;CanvasRenderingContext2D=H;CanvasGradient=D;CanvasPattern=W})();html5.canvas=jsb.behavior.extend({onattach:function(a){G_vmlCanvasManager.initElement(a)},getContext:function(a){return a.getContext()}});